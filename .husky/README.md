# Husky - Git Hooks ç®¡ç†

è¿™ä¸ªç›®å½•åŒ…å« Husky é…ç½®çš„ Git é’©å­ã€‚Husky æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Git é’©å­æ¡†æ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨ Git æ“ä½œå‰è‡ªåŠ¨è¿è¡Œè„šæœ¬ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

### pre-commit
åœ¨æäº¤å‰æ‰§è¡Œçš„é’©å­ã€‚è´Ÿè´£ï¼š
- è¿è¡Œ ESLint æ£€æŸ¥ JavaScript/Vue æ–‡ä»¶
- è¿è¡Œ Prettier æ ¼å¼åŒ–ä»£ç 
- æ£€æŸ¥ PHP æ–‡ä»¶è¯­æ³•
- è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜

### commit-msg
åœ¨æäº¤ä¿¡æ¯éªŒè¯é˜¶æ®µæ‰§è¡Œçš„é’©å­ã€‚è´Ÿè´£ï¼š
- è¿è¡Œ Commitlint éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼
- ç¡®ä¿ç¬¦åˆçº¦å®šå¼æäº¤è§„èŒƒ

## ğŸš€ å®‰è£…å’Œåˆå§‹åŒ–

é¦–æ¬¡è®¾ç½®é¡¹ç›®æ—¶ï¼š

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. åˆå§‹åŒ– Husky
npm run prepare

# 3. éªŒè¯å®‰è£…
ls -la .husky/
```

## ğŸ”„ å·¥ä½œæµç¨‹

### æ­£å¸¸æäº¤æµç¨‹

```
git add .
  â†“
git commit -m "feat: add new feature"
  â†“
Pre-commit hook
  â”œâ”€ ESLint æ£€æŸ¥
  â”œâ”€ Prettier æ ¼å¼åŒ–
  â”œâ”€ PHP è¯­æ³•æ£€æŸ¥
  â””â”€ æ·»åŠ æ ¼å¼åŒ–æ–‡ä»¶å›æš‚å­˜åŒº
  â†“
Commit-msg hook
  â””â”€ Commitlint éªŒè¯æäº¤ä¿¡æ¯
  â†“
âœ… æäº¤æˆåŠŸ
```

### æ£€æŸ¥å¤±è´¥æµç¨‹

```
æ£€æŸ¥å¤±è´¥
  â†“
æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  â†“
ä¿®å¤é—®é¢˜
  â†“
é‡æ–°å°è¯•æäº¤
  â†“
âœ… æäº¤æˆåŠŸ
```

## âš™ï¸ é…ç½®è¯´æ˜

### ESLint æ£€æŸ¥
- æ£€æŸ¥æ‰€æœ‰ `.js` å’Œ `.vue` æ–‡ä»¶
- è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜
- ä¸é€šè¿‡åˆ™åœæ­¢æäº¤

### Prettier æ ¼å¼åŒ–
- æ ¼å¼åŒ–æ‰€æœ‰ä»£ç æ–‡ä»¶
- ç»Ÿä¸€ä»£ç é£æ ¼
- è‡ªåŠ¨æ·»åŠ æ ¼å¼åŒ–æ–‡ä»¶

### PHP è¯­æ³•æ£€æŸ¥
- æ£€æŸ¥æ‰€æœ‰æ–°å¢ `.php` æ–‡ä»¶
- éªŒè¯ PHP è¯­æ³•æ­£ç¡®æ€§
- å‘ç°é—®é¢˜åœæ­¢æäº¤

### Commitlint éªŒè¯
- æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼
- éªŒè¯æäº¤ç±»å‹æœ‰æ•ˆæ€§
- æ£€æŸ¥ä¸»é¢˜ç¬¦åˆè§„èŒƒ

## ğŸ› ï¸ å¸¸è§å‘½ä»¤

### æŸ¥çœ‹é’©å­çŠ¶æ€
```bash
husky list
```

### æ‰‹åŠ¨è¿è¡Œé’©å­
```bash
# æ‰‹åŠ¨è¿è¡Œ pre-commit é’©å­
npx husky run pre-commit

# æ‰‹åŠ¨è¿è¡Œ commit-msg é’©å­
npx husky run commit-msg "feat: test message"
```

### ç»•è¿‡é’©å­ï¼ˆä»…åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼‰
```bash
# ç»•è¿‡æ‰€æœ‰é’©å­
git commit --no-verify -m "message"

# âš ï¸ ä»…ç”¨äºç´§æ€¥ä¿®å¤ï¼Œä¸æ¨è
```

### ç¦ç”¨/å¯ç”¨é’©å­
```bash
# ä¸´æ—¶ç¦ç”¨æ‰€æœ‰é’©å­
husky uninstall

# é‡æ–°å¯ç”¨é’©å­
npm run prepare
```

### é‡æ–°åˆå§‹åŒ–
```bash
# å®Œå…¨é‡æ–°åˆå§‹åŒ– Husky
rm -rf .husky
npm run prepare
```

## ğŸ“‹ é’©å­æ–‡ä»¶ç¼–è¾‘è¯´æ˜

### ä¿®æ”¹ pre-commit é’©å­

ç¼–è¾‘ `.husky/pre-commit` æ–‡ä»¶æ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥ï¼š

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# è‡ªå®šä¹‰æ£€æŸ¥è„šæœ¬
echo "ğŸ” Running custom checks..."

# ä½ çš„è„šæœ¬

# å§‹ç»ˆè¿”å›åˆé€‚çš„é€€å‡ºç 
exit 0
```

### ä¿®æ”¹ commit-msg é’©å­

ç¼–è¾‘ `.husky/commit-msg` æ–‡ä»¶ä¿®æ”¹æäº¤ä¿¡æ¯éªŒè¯ï¼š

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# è‡ªå®šä¹‰éªŒè¯é€»è¾‘
# ...
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šé’©å­æœªæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la .husky/

# æ·»åŠ å¯æ‰§è¡Œæƒé™
chmod +x .husky/pre-commit
chmod +x .husky/commit-msg
```

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°å‘½ä»¤

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
npm install

# é‡æ–°åˆå§‹åŒ– Husky
npm run prepare
```

### é—®é¢˜ï¼šESLint æˆ– Prettier æŠ¥é”™

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.eslintrc.cjs` é…ç½®
2. æ£€æŸ¥ `.prettierrc` é…ç½®
3. è¿è¡Œ `npm run lint:fix` æ‰‹åŠ¨ä¿®å¤
4. æŸ¥çœ‹é”™è¯¯è¯¦æƒ…å¹¶ä¿®æ”¹ä»£ç 

### é—®é¢˜ï¼šPHP æ£€æŸ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ PHP æ˜¯å¦å®‰è£…ï¼ˆ`which php`ï¼‰
2. ä¿®å¤ PHP è¯­æ³•é”™è¯¯
3. è¿è¡Œ `php -l filename.php` æŸ¥çœ‹è¯¦ç»†é”™è¯¯

### é—®é¢˜ï¼šGit æ“ä½œç¼“æ…¢

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥é’©å­è„šæœ¬æ˜¯å¦è¿‡é•¿
2. è€ƒè™‘å°†å¤§å‹æ£€æŸ¥ç§»è‡³ CI/CD
3. å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„æ£€æŸ¥ä»»åŠ¡

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ä»…æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶
å½“å‰é…ç½®å·²é€šè¿‡ `lint-staged` å®ç°ï¼Œåªæ£€æŸ¥æš‚å­˜çš„æ–‡ä»¶ã€‚

### å¹¶è¡Œæ‰§è¡Œæ£€æŸ¥
```bash
# åœ¨ pre-commit é’©å­ä¸­å¹¶è¡Œæ‰§è¡Œ
npx eslint --fix & npx prettier --write & php syntax-check.php
wait
```

### ç¼“å­˜
- ESLint æ”¯æŒç¼“å­˜ï¼ˆ`.eslintcache`ï¼‰
- Prettier ä¼šè‡ªåŠ¨ç¼“å­˜
- å¯åŠ å¿«åç»­æ£€æŸ¥é€Ÿåº¦

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `COMMIT_CONVENTION.md` - Git æäº¤è§„èŒƒ
- `DEVELOPER_GUIDE.md` - å¼€å‘æŒ‡å—
- `commitlint.config.js` - Commitlint é…ç½®
- `.lintstagedrc.json` - lint-staged é…ç½®

## ğŸ” å®‰å…¨è€ƒè™‘

1. **æ£€æŸ¥è„šæœ¬æ¥æº** - ç¡®ä¿é’©å­è„šæœ¬æ¥è‡ªå¯ä¿¡æ¥æº
2. **é¿å…æƒé™æå‡** - é’©å­ä¸åº”è¯¥è¦æ±‚ sudo
3. **å®‰å…¨æ•æ„Ÿä¿¡æ¯** - ä¸è¦åœ¨é’©å­ä¸­å¤„ç†æ•æ„Ÿä¿¡æ¯
4. **æ—¥å¿—ç®¡ç†** - ä¿æŠ¤é’©å­æ‰§è¡Œæ—¥å¿—

## ğŸ“ æœ€ä½³å®è·µ

1. **å®šæœŸæ›´æ–°** - ä¿æŒä¾èµ–åŒ…æ›´æ–°
2. **å›¢é˜Ÿåä½œ** - æ‰€æœ‰æˆå‘˜ä½¿ç”¨ç›¸åŒé…ç½®
3. **CI/CD é›†æˆ** - ç»“åˆ CI/CD ç³»ç»Ÿä½¿ç”¨
4. **æ–‡æ¡£ç»´æŠ¤** - æ›´æ–°é…ç½®æ—¶æ›´æ–°æ–‡æ¡£
5. **æ€§èƒ½å¹³è¡¡** - åœ¨æ£€æŸ¥ä¸¥æ ¼æ€§å’Œé€Ÿåº¦é—´å–å¾—å¹³è¡¡

## ğŸ“ å˜æ›´æ—¥å¿—

### v1.0.0 (2024)
- åˆå§‹åŒ– Husky é…ç½®
- æ·»åŠ  pre-commit å’Œ commit-msg é’©å­
- é›†æˆ ESLintã€Prettierã€Commitlint
- ç¼–å†™å®Œæ•´æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2024  
**ç»´æŠ¤è€…**: Development Team
