# CORS 跨域资源共享配置
# 此配置文件为所有响应添加 CORS 头，支持跨源请求

# 定义允许的源地址
set $cors_origin '';

# 检查来源是否在允许列表中
# 本地开发环境
if ($http_origin ~* ^https?://localhost:(3000|5173|8080)$) {
  set $cors_origin $http_origin;
}

# 本地 127.0.0.1
if ($http_origin ~* ^https?://127\.0\.0\.1:(3000|5173|8080)$) {
  set $cors_origin $http_origin;
}

# 生产环境域名 (需要根据实际情况修改)
if ($http_origin ~* ^https?://yourdomain\.com$) {
  set $cors_origin $http_origin;
}

if ($http_origin ~* ^https?://www\.yourdomain\.com$) {
  set $cors_origin $http_origin;
}

# 预检请求处理
if ($request_method = 'OPTIONS') {
  add_header 'Access-Control-Allow-Origin' $cors_origin always;
  add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
  add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-WP-Nonce' always;
  add_header 'Access-Control-Allow-Credentials' 'true' always;
  add_header 'Access-Control-Max-Age' '3600' always;
  add_header 'Content-Type' 'text/plain; charset=utf-8' always;
  add_header 'Content-Length' '0' always;
  return 204;
}

# 常规请求的 CORS 头
add_header 'Access-Control-Allow-Origin' $cors_origin always;
add_header 'Access-Control-Allow-Credentials' 'true' always;
add_header 'Access-Control-Expose-Headers' 'X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset' always;
